<!DOCTYPE html>
<!--
   "If you remember the shape of your spoon at lunch,
            it has to be the wrong shape."
                                 -Adrian Frutiger
-->

<html>
  <head>
    <title>SystemLite</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/svg.css">
    <link rel="stylesheet" href="css/logs.css">
    <link rel="stylesheet" href="css/tabbar.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/hud.css">
  </head>
  <body>
    <div class="hud" v-show="activePanel != 'none'" id="hud" v-cloak>
      <h1>{{ activePanel.toUpperCase() }}</h1>
      <span class="close-button" v-on:click="closeBox()"></span>
      <div class="separator"></div>
      <div class="dynamic">
        <template v-if="activePanel == 'confirm'">
          <h4>{{ confirmPanel.prompt }}</h4>
          <button v-on:click="affirmativeClick()">YES</button>
          <button v-on:click="negativeClick()">NO</button>
        </template>
      </div>
    </div>
    <div class="log-display"
         id="logelement"
         v-bind:class="{ 'hidden' : isHidden, 'unhidden': !isHidden, 'alert':flashRed }"
         v-on:click.stop="showLogs()">
      <div>
        <span class="log-hide" v-on:click.stop="hideLogs()">
          Hide Logs<span class="close-button"></span>
        </span>
        <span class="log-hide" v-on:click.stop="clearLogs()">
          Clear Logs
        </span>
      </div>
      <div class="log-box" id="logbox" v-cloak>
        <div v-for="item in logData" class="log-item" v-bind:class="item.level">
          <div>
            {{ item.ts }}
            <span v-if="item.count > 0">({{ item.count }})</span>
            <span v-if="item.source">@ {{ item.source }}</span>
          </div>
          <span>{{ item.msg }}</span>
        </div>
        <div class="log-spacer"></div>
      </div>
    </div>
    <div class="sl-page">
      <div class="sl-item header">
        System Lite - Cloud Data Services SRE
      </div>
      <div class="sl-item tabs">
        <!-- TABS -->
        <ul class="tab-box" id="components" v-cloak>
          <li v-for="component in compList"
              v-on:click="tabClick($index, $event)"
              v-bind:class="{ 'tab-selected': component.selected }">
            <div class="tab-item" v-cloak>
              <!-- This data binding is one directional. I think that is ok because it
              prevents the user from creating an unvalidated in-between state while
              they are in the process of editing the element -->
              <span class="tab-name" data-tagitem="true">{{ component.name }}</span>
              <span class="tab-delete" v-on:click="deleteTab($index)"></span>
            </div>
          </li>
          <li v-on:click="newTab()" id="new-tab">
            <div class="tab-item">+</div>
          </li>
        </ul>
      </div>
      <div class="sl-item body">
        <!-- SVG Board -->
        <svg width="5000" height="5000" id="svgCanvas" v-on:mouseup="dragStop()"
             v-on:mousemove="mouseMove" v-on:dblclick="doubleClickCanvas($event)">
          <g :transform="scaleFactorStyle">
            <!-- Render Paths -->
            <g v-for="path in paths">
              <path class="connectingPath" :d="path">
            </g>
            <!-- Render Circles -->
            <g v-for="item in circles">
              <circle v-on:mousedown="dragStart($event, $index)"
                      v-on:dblclick="doubleClickCircle($event, $index)"
                      data-type="circles"
                      class="outerElement"
                      :cx="item.x" :cy="item.y" :r="item.r" :stroke="item.style.outColor"
                      stroke-width="1" :fill="item.style.inColor" />
              <rect :x="item.x+item.r" :y="item.y-2" rx="2" ry="2" width="2" height="2"
                    class="lineNode" v-on:mousedown="lineStart($event, $index)" />
              <rect :x="item.x-item.r-2" :y="item.y-2" rx="2" ry="2" width="2" height="2"
                    class="lineNode" v-on:mouseup="connectPath($index)" />
              <text text-anchor="middle" :x="item.x" :y="item.y-item.r-4" fill="black" font-size="8">
                {{ item.label }}
              </text>
            </g>
            <!-- Render Active Path -->
            <path v-if="active_path" class="connectingPath" :d="active_path">
          </g>
        </svg>
      </div>
      <div id="canvasControl" class="sl-item footer" v-bind:class="{ 'expand': showPalette }">
        <span v-on:click="scaleSvgButton(1)" class="scalebutton">+</span>
        <span v-on:click="scaleSvgButton(0)" class="scalebutton">&#9675;</span>
        <span v-on:click="scaleSvgButton(-1)" class="scalebutton">-</span>
        <span class="textbutton active" v-on:click="commitChanges()">
          COMMIT CHANGES
        </span>
        <span class="textbutton active" v-on:click="togglePalette()">
          <span v-show="!showPalette">SHOW</span>
          <span v-show="showPalette">HIDE</span>
          PALETTE
        </span>
        <svg width="100%" height="185" id="svgPalette">
          <g v-for="node in nodes" class="nodeButton">
            <text text-anchor="middle" :x="node.x" y="28" fill="black" font-size="20">
              {{ node.name }}
            </text>
            <circle stroke-dasharray="5,5"
              :cx="node.x" :cy="node.y" r="65" :stroke="node.strokeColor"
              stroke-width="2" :fill="node.fill" />
            <text text-anchor="middle" :x="node.x + 1" :y="node.y + 30 + 1" fill="black" font-size="90">
              {{ node.detail }}
            </text>
          </g>
        </svg>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.11/vue.js"></script>
    <script src="js/hud.js"></script>
    <script src="js/svg.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/logs.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
